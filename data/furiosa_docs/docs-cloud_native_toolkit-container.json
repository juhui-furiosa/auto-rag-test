{
  "title": "Container Support",
  "url": "https://developer.furiosa.ai/latest/en/cloud_native_toolkit/container.html",
  "version": "2025.3.1",
  "content": "# Container Support[#](#container-support \"Link to this heading\")\n\n## Container Runtime Support[#](#container-runtime-support \"Link to this heading\")\n\nWe do support the following versions of container runtimes:\n\n* Docker: v25.0.0 or later\n* ContainerD: v1.7.0 or later\n* CRI-O: v1.28.0 or later\n\nNote\n\nThe supported container runtimes above (Docker, ContainerD, CRI-O) are validated with the default low-level container runtime `runc`.\nOther low-level runtimes or isolation technologies (such as `crun`, `gVisor`, or `firecracker`) are not officially tested and may have compatibility limitations.\n\nWarning\n\nSome container runtimes use default seccomp profiles that filter out the following `io_uring` syscalls due to [security considerations](https://github.com/moby/moby/pull/46762):\n\n* io\\_uring\\_setup\n* io\\_uring\\_enter\n* io\\_uring\\_register\n\nRNGD driver relies on these syscalls. Therefore, users must either create and apply a custom seccomp profile explicitly permitting these syscalls or run containers with the unconfined seccomp setting.\n\n## Container Device Interface Support[#](#container-device-interface-support \"Link to this heading\")\n\nContainer Device Interface (CDI) is a standard interface and specification for exposing devices to container runtimes.\nIt provides abstract mechanisms required to allocate and expose these devices to containers.\nThis abstraction simplifies device management and enhances user experience by hiding complex device integration details.\n\n### Installing `furiosa-cdi` CLI[#](#installing-furiosa-cdi-cli \"Link to this heading\")\n\nTo install the `furiosa-cdi` CLI, install the `furiosa-cdi` package.\n\nThe minimum requirements for installing `furiosa-cdi` package are as follows:\n\n* Ubuntu 22.04 LTS (Debian Bookworm) or later\n* Linux Kernel 6.3 or later\n* Administrator privileges on system (root)\n* [Setting up APT](../get_started/prerequisites.html#aptsetup) and [Installing Prerequisites](../get_started/prerequisites.html#installingprerequisites)\n\nThen, please install the `furiosa-cdi` package as follows:\n\n```\nsudo apt update\nsudo apt install -y furiosa-cdi\n```\n\nCopy to clipboard\n\nThis command installs packages `furiosa-libsmi` and `furiosa-cdi`.\n\n### Generating CDI Specification[#](#generating-cdi-specification \"Link to this heading\")\n\nFollowing command generates a CDI specification file in the `/etc/cdi` directory, enabling your container runtime to identify and manage Furiosa NPUs as CDI resources.\n\n```\nsudo furiosa-cdi generate\n```\n\nCopy to clipboard\n\n### Configuring Container Runtimes[#](#configuring-container-runtimes \"Link to this heading\")\n\nDepending on the container runtime and version, CDI feature may need to be explicitly enabled through configuration.\nThe section below provides detailed instructions for configuring CDI for each supported runtime.\n\n#### Docker[#](#docker \"Link to this heading\")\n\nDocker currently supports CDI as an experimental feature.\nUpdate the Docker daemon configuration file `daemon.json` to enable CDI feature and include `/etc/cdi` in the `cdi-spec-dirs` setting.\nBelow is an example of `daemon.json` configuration:\n\n```\n{\n  \"features\": {\n     \"cdi\": true\n  },\n  \"cdi-spec-dirs\": [\"/etc/cdi/\", \"/var/run/cdi\"]\n}\n```\n\nCopy to clipboard\n\nFor more details, refer to the official Docker documentation on [enabling CDI devices](https://docs.docker.com/reference/cli/dockerd/#enable-cdi-devices).\n\n#### ContainerD[#](#containerd \"Link to this heading\")\n\nContainerD supports CDI starting from version 2.0.0 by default.\nFor earlier versions, CDI must be explicitly enabled through the configuration file config.toml, typically located at `/etc/containerd/config.toml`.\n\nTo enable CDI support, add the following configuration:\n\n```\n[plugins.\"io.containerd.grpc.v1.cri\"]\nenable_cdi = true\ncdi_spec_dirs = [\"/etc/cdi\", \"/var/run/cdi\"]\n```\n\nCopy to clipboard\n\nAfter modifying the configuration, restart ContainerD to apply the changes:\n\n```\nsudo systemctl restart containerd\n```\n\nCopy to clipboard\n\nFor more details, refer to the official ContainerD documentation on [enabling CDI support](https://github.com/containerd/containerd/blob/main/docs/cri/config.md).\n\n#### CRI-O[#](#cri-o \"Link to this heading\")\n\nCRI-O enables CDI support by default, configured to use the standard CDI directories `/etc/cdi` and `/var/run/cdi`.\n\n### Assign Furiosa NPUs to Containers using CDI[#](#assign-furiosa-npus-to-containers-using-cdi \"Link to this heading\")\n\nAfter generating the CDI specification, use the furiosa-cdi list command to discover available NPU resources.\nThe special entry `all` aggregates all available NPUs for simultaneous allocation:\n\n```\nfuriosa-cdi list\n+----------------+------+\n|      KIND      | NAME |\n+----------------+------+\n|                | npu0 |\n|                | npu1 |\n|                | npu2 |\n|                | npu3 |\n| furiosa.ai/npu | npu4 |\n|                | npu5 |\n|                | npu6 |\n|                | npu7 |\n|                | all  |\n+----------------+------+\n```\n\nCopy to clipboard\n\nBelow is an example of assigning `npu0` to a Docker container using CDI:\n\n```\ndocker run --security-opt seccomp=unconfined --device=furiosa.ai/npu=npu0 -it ubuntu:latest /bin/bash\n```\n\nCopy to clipboard\n\nTo allocate multiple NPUs, repeat the `--device` option or use the `all` entry:\n\n```\n# Allocating multiple NPUs\ndocker run --security-opt seccomp=unconfined \\\n  --device=furiosa.ai/npu=npu0 \\\n  --device=furiosa.ai/npu=npu1 \\\n  -it ubuntu:latest /bin/bash\n\n# Allocating all NPUs at once\ndocker run --security-opt seccomp=unconfined \\\n  --device=furiosa.ai/npu=all \\\n  -it ubuntu:latest /bin/bash\n```\n\nCopy to clipboard\n\nSimilarly, for ContainerD (ctr/nerdctl) and CRI-O, use their respective CDI syntax to reference Furiosa NPU devices.\n\n## Assign Furiosa NPUs to Containers Manually[#](#assign-furiosa-npus-to-containers-manually \"Link to this heading\")\n\nIn environments where CDI support is unavailable or if manual allocation of Furiosa NPUs is preferred, this section provides guidance for manually assigning Furiosa NPUs to containers.\n\nTo use a Furiosa NPU inside a container, the corresponding device nodes must be mapped into the container.\nEach Furiosa card has 35 required device nodes. The device node paths follow the format below, where `{index}` represents the NPU device number (e.g., `npu0`, `npu1`):\n\n```\n/dev/rngd/npu{index}bar0\n/dev/rngd/npu{index}bar2\n/dev/rngd/npu{index}bar4\n/dev/rngd/npu{index}ch0\n/dev/rngd/npu{index}ch0r\n/dev/rngd/npu{index}ch1\n/dev/rngd/npu{index}ch1r\n/dev/rngd/npu{index}ch2\n/dev/rngd/npu{index}ch2r\n/dev/rngd/npu{index}ch3\n/dev/rngd/npu{index}ch3r\n/dev/rngd/npu{index}ch4\n/dev/rngd/npu{index}ch4r\n/dev/rngd/npu{index}ch5\n/dev/rngd/npu{index}ch5r\n/dev/rngd/npu{index}ch6\n/dev/rngd/npu{index}ch6r\n/dev/rngd/npu{index}ch7\n/dev/rngd/npu{index}ch7r\n/dev/rngd/npu{index}dmar\n/dev/rngd/npu{index}mgmt\n/dev/rngd/npu{index}pe0\n/dev/rngd/npu{index}pe0-1\n/dev/rngd/npu{index}pe0-3\n/dev/rngd/npu{index}pe1\n/dev/rngd/npu{index}pe2\n/dev/rngd/npu{index}pe2-3\n/dev/rngd/npu{index}pe3\n/dev/rngd/npu{index}pe4\n/dev/rngd/npu{index}pe4-5\n/dev/rngd/npu{index}pe4-7\n/dev/rngd/npu{index}pe5\n/dev/rngd/npu{index}pe6\n/dev/rngd/npu{index}pe6-7\n/dev/rngd/npu{index}pe7\n```\n\nCopy to clipboard\n\nBelow is an example of how to assign the device nodes for `npu0` to a container using Docker.\nFor ContainerD (ctr/nerdctl) and CRI-O, pass the device nodes listed above and configure the required seccomp settings.\n\n```\ndocker run --security-opt seccomp=unconfined -it \\\n  --device /dev/rngd/npu0bar0:rw \\\n  --device /dev/rngd/npu0bar2:rw \\\n  --device /dev/rngd/npu0bar4:rw \\\n  --device /dev/rngd/npu0ch0:rw \\\n  --device /dev/rngd/npu0ch0r:rw \\\n  --device /dev/rngd/npu0ch1:rw \\\n  --device /dev/rngd/npu0ch1r:rw \\\n  --device /dev/rngd/npu0ch2:rw \\\n  --device /dev/rngd/npu0ch2r:rw \\\n  --device /dev/rngd/npu0ch3:rw \\\n  --device /dev/rngd/npu0ch3r:rw \\\n  --device /dev/rngd/npu0ch4:rw \\\n  --device /dev/rngd/npu0ch4r:rw \\\n  --device /dev/rngd/npu0ch5:rw \\\n  --device /dev/rngd/npu0ch5r:rw \\\n  --device /dev/rngd/npu0ch6:rw \\\n  --device /dev/rngd/npu0ch6r:rw \\\n  --device /dev/rngd/npu0ch7:rw \\\n  --device /dev/rngd/npu0ch7r:rw \\\n  --device /dev/rngd/npu0dmar:rw \\\n  --device /dev/rngd/npu0mgmt:rw \\\n  --device /dev/rngd/npu0pe0:rw \\\n  --device /dev/rngd/npu0pe0-1:rw \\\n  --device /dev/rngd/npu0pe0-3:rw \\\n  --device /dev/rngd/npu0pe1:rw \\\n  --device /dev/rngd/npu0pe2:rw \\\n  --device /dev/rngd/npu0pe2-3:rw \\\n  --device /dev/rngd/npu0pe3:rw \\\n  --device /dev/rngd/npu0pe4:rw \\\n  --device /dev/rngd/npu0pe4-5:rw \\\n  --device /dev/rngd/npu0pe4-7:rw \\\n  --device /dev/rngd/npu0pe5:rw \\\n  --device /dev/rngd/npu0pe6:rw \\\n  --device /dev/rngd/npu0pe6-7:rw \\\n  --device /dev/rngd/npu0pe7:rw \\\n  ubuntu:latest /bin/bash\n```\n\nCopy to clipboard",
  "external_links": [
    {
      "text": "security considerations",
      "url": "https://github.com/moby/moby/pull/46762"
    },
    {
      "text": "enabling CDI devices",
      "url": "https://docs.docker.com/reference/cli/dockerd/#enable-cdi-devices"
    },
    {
      "text": "enabling CDI support",
      "url": "https://github.com/containerd/containerd/blob/main/docs/cri/config.md"
    }
  ]
}